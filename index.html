<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GlowSkin - Diskusi Produk</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <!-- Firebase Auth SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

    <style>
        :root {
            --primary-bg: #fdfbf7;
            --text-dark: #333333;
            --text-light: #666666;
            --accent-toner: #9e8fb2;
            --accent-toner-dark: #7a6b8e;
            --accent-serum: #e6a4a4;
            --accent-serum-dark: #cf7878;
            --accent-me: #4caf50;
            --white: #ffffff;
            --shadow: 0 10px 30px rgba(0,0,0,0.08);
            --transition: all 0.3s ease;
            --bright-gradient: linear-gradient(45deg, #FF6B6B, #FF8E53);
            --admin-color: #FF9800; /* Warna Admin (Oranye/Emas) */
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body { font-family: 'Poppins', sans-serif; background-color: var(--primary-bg); color: var(--text-dark); line-height: 1.6; min-height: 100vh; display: flex; flex-direction: column; }

        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- HEADER --- */
        header { background-color: var(--white); padding: 1rem 5%; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 1000; }
        .logo { font-size: 1.5rem; font-weight: 700; color: var(--text-dark); display: flex; align-items: center; gap: 10px; cursor: pointer; }
        nav { display: flex; gap: 1.2rem; align-items: center; }
        .nav-link { text-decoration: none; color: var(--text-light); font-weight: 600; cursor: pointer; transition: var(--transition); font-size: 0.9rem; }
        .nav-link:hover { color: var(--text-dark); }
        .nav-link.toner-link:hover { color: var(--accent-toner); }
        .nav-link.serum-link:hover { color: var(--accent-serum); }

        /* BUTTONS AUTH */
        .auth-btn {
            background: var(--white); border: 1px solid #ddd; padding: 8px 20px; 
            border-radius: 50px; cursor: pointer; font-weight: 600; color: var(--text-light); 
            transition: var(--transition); font-size: 0.9rem;
        }
        .auth-btn:hover { border-color: var(--accent-me); color: var(--accent-me); }
        
        .user-profile { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; font-weight: 600; color: var(--text-dark); }
        .logout-btn { color: #ff4d4d; cursor: pointer; border: none; background: none; font-size: 0.9rem; }
        .logout-btn:hover { text-decoration: underline; }

        /* --- CARDS & SELECTION --- */
        .hero { text-align: center; padding: 3rem 1rem 1rem; max-width: 800px; margin: 0 auto; }
        .hero h1 { font-size: 2.5rem; margin-bottom: 1rem; }
        .hero p { color: var(--text-light); }

        .selection-container { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; padding: 2rem 5%; max-width: 1200px; margin: 0 auto 4rem; flex-grow: 1; }
        .card { background: var(--white); border-radius: 20px; overflow: hidden; box-shadow: var(--shadow); transition: var(--transition); cursor: pointer; border: 1px solid transparent; }
        .card:hover { transform: translateY(-10px); box-shadow: 0 20px 40px rgba(0,0,0,0.12); }
        .toner-card:hover { border-color: var(--accent-toner); }
        .serum-card:hover { border-color: var(--accent-serum); }

        .card-image { height: 250px; overflow: hidden; position: relative; }
        .card-image img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s ease; }
        .card:hover .card-image img { transform: scale(1.05); }
        .card-content { padding: 2rem; text-align: center; }
        .card-icon { font-size: 2rem; margin-bottom: 1rem; display: block; }
        .toner-card .card-icon { color: var(--accent-toner); }
        .serum-card .card-icon { color: var(--accent-serum); }
        .btn-card { display: inline-block; margin-top: 1rem; padding: 10px 25px; border-radius: 50px; color: white; font-weight: 600; text-decoration: none; transition: var(--transition); }
        .toner-card .btn-card { background-color: var(--accent-toner); }
        .serum-card .btn-card { background-color: var(--accent-serum); }

        /* --- AUTH FORMS (LOGIN & REGISTER) --- */
        .auth-container {
            max-width: 400px; margin: 4rem auto; padding: 2rem;
            background: var(--white); border-radius: 20px; box-shadow: var(--shadow); text-align: center;
        }
        .auth-container h2 { margin-bottom: 1.5rem; color: var(--accent-toner-dark); }
        .form-group { margin-bottom: 1.2rem; text-align: left; }
        .form-label { display: block; margin-bottom: 0.5rem; font-weight: 600; font-size: 0.9rem; }
        .form-input { width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 10px; font-family: 'Poppins', sans-serif; font-size: 0.95rem; transition: var(--transition); }
        .form-input:focus { outline: none; border-color: var(--accent-toner); box-shadow: 0 0 0 3px rgba(158, 143, 178, 0.2); }
        
        .primary-btn { width: 100%; padding: 12px; background: var(--accent-toner); color: white; border: none; border-radius: 50px; font-weight: 700; cursor: pointer; transition: var(--transition); font-size: 1rem; }
        .primary-btn:hover { background: var(--accent-toner-dark); transform: translateY(-2px); }

        .auth-switch { margin-top: 1rem; font-size: 0.9rem; }
        .auth-switch a { color: var(--accent-toner); font-weight: 600; text-decoration: none; cursor: pointer; }
        .auth-switch a:hover { text-decoration: underline; }

        /* --- PRODUCT & FORUM --- */
        .product-page { padding: 2rem 5%; max-width: 1200px; margin: 0 auto 4rem; flex-grow: 1; }
        .detail-container { display: flex; flex-wrap: wrap; background: var(--white); border-radius: 30px; overflow: hidden; box-shadow: var(--shadow); }
        .detail-image { flex: 1 1 400px; height: 500px; position: relative; }
        .detail-image img { width: 100%; height: 100%; object-fit: cover; }
        .detail-content { flex: 1 1 400px; padding: 3rem; display: flex; flex-direction: column; justify-content: center; }
        
        .back-btn { display: inline-flex; align-items: center; gap: 8px; margin-bottom: 1.5rem; color: var(--text-light); text-decoration: none; font-weight: 600; cursor: pointer; transition: var(--transition); }
        .back-btn:hover { color: var(--text-dark); transform: translateX(-5px); }

        .detail-content h2 { font-size: 2.5rem; margin-bottom: 0.5rem; }
        .detail-price { font-size: 1.5rem; font-weight: 700; margin-bottom: 2rem; display: block; }
        .detail-desc { color: var(--text-light); margin-bottom: 2rem; line-height: 1.8; }
        
        .feature-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 2.5rem; }
        .feature-item { display: flex; align-items: center; gap: 10px; font-weight: 500; }
        #page-toner .detail-price { color: var(--accent-toner); }
        #page-toner .action-btn { background-color: var(--accent-toner); }
        #page-serum .detail-price { color: var(--accent-serum); }
        #page-serum .action-btn { background-color: var(--accent-serum); }

        .action-btn { width: 100%; padding: 15px; border: none; border-radius: 50px; color: rgb(0, 0, 0); font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: var(--transition); text-align: center; display: block; }
        .action-btn:hover { opacity: 0.9; transform: scale(1.02); }

        /* FORUM UI */
        .qa-feed-header { margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid #eee; }
        .forum-wrapper { display: grid; grid-template-columns: 1fr 1.5fr; gap: 2rem; align-items: start; }
        .form-card { background: var(--white); padding: 2rem; border-radius: 20px; box-shadow: var(--shadow); position: sticky; top: 100px; }
        
        .form-group { margin-bottom: 1.2rem; }
        .form-label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-dark); }
        .form-input, .form-textarea, .form-select { width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 10px; font-family: 'Poppins', sans-serif; font-size: 0.95rem; transition: var(--transition); }
        .form-input:focus, .form-textarea:focus { outline: none; border-color: #FF6B6B; box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1); }
        .form-select:disabled { background-color: #f9f9f9; color: #888; cursor: not-allowed; }

        .submit-btn { width: 100%; padding: 15px; background: var(--bright-gradient); color: white; border: none; border-radius: 50px; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: var(--transition); box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4); }
        .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6); }

        /* COMMENTS CARDS */
        .qa-card { background: var(--white); border-radius: 15px; padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: 0 4px 10px rgba(0,0,0,0.05); transition: var(--transition); position: relative; border: 1px solid transparent; }
        .qa-card:hover { box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .qa-card.my-question { border: 2px solid var(--accent-me); background-color: #f9fff9; }

        .delete-btn { position: absolute; top: 15px; right: 15px; background: none; border: none; color: #ccc; cursor: pointer; font-size: 1rem; transition: var(--transition); padding: 5px; }
        .delete-btn:hover { color: #ff4d4d; transform: scale(1.1); }

        .qa-meta { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; font-size: 0.9rem; color: var(--text-light); }
        .qa-avatar { width: 35px; height: 35px; background: #eee; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--text-light); }
        .qa-name { font-weight: 700; color: var(--text-dark); }
        .qa-question { font-weight: 500; font-size: 1.1rem; color: var(--text-dark); margin-bottom: 1rem; }

        /* MULTI REPLIES */
        .qa-replies-list { margin-top: 1rem; border-top: 1px solid #eee; padding-top: 1rem; }
        .reply-item { background: #fafafa; padding: 10px 15px; border-radius: 10px; margin-bottom: 0.8rem; border-left: 3px solid #ddd; font-size: 0.95rem; }
        .reply-item.my-reply { border-left-color: var(--accent-me); background: #f0fff4; }
        .reply-header { font-size: 0.8rem; color: #888; margin-bottom: 4px; display: flex; justify-content: space-between; }
        .reply-name { font-weight: 700; color: var(--text-dark); }

        .btn-reply { background: none; border: 1px solid #ddd; padding: 5px 15px; border-radius: 20px; cursor: pointer; font-size: 0.85rem; transition: var(--transition); margin-left: 45px; }
        .btn-reply:hover { background: #eee; color: var(--text-dark); }

        .reply-form-input-area { margin-top: 1rem; margin-left: 45px; display: none; }
        .reply-form-input-area.active { display: block; animation: fadeIn 0.3s; }

        /* ADMIN STYLES */
        .badge-admin {
            background-color: var(--admin-color);
            color: white;
            font-size: 0.65rem;
            font-weight: 800;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 5px;
            vertical-align: middle;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 5px rgba(255, 152, 0, 0.3);
        }

        footer { background-color: var(--white); padding: 2rem; text-align: center; border-top: 1px solid #eee; margin-top: auto; }

        @media (max-width: 900px) { .forum-wrapper { grid-template-columns: 1fr; } .form-card { position: static; } }
        @media (max-width: 768px) { .selection-container { grid-template-columns: 1fr; } .detail-image { height: 300px; } .detail-content { padding: 2rem; } .hero h1 { font-size: 2rem; } nav { display: none; } }
    </style>
</head>
<body>

    <!-- Header -->
    <header>
        <div class="logo" onclick="navigateTo('home')">
            <i class="fas fa-leaf"></i> GlowSkin
        </div>
        <nav>
            <!-- Link Produk -->
            <a class="nav-link toner-link" onclick="navigateTo('toner')">Toner</a>
            <a class="nav-link serum-link" onclick="navigateTo('serum')">Serum</a>
            <a class="nav-link toner-link" onclick="navigateTo('toner-forum')">Diskusi Toner</a>
            <a class="nav-link serum-link" onclick="navigateTo('serum-forum')">Diskusi Serum</a>
            
            <!-- Area Auth (Login / Profil) -->
            <div id="auth-section">
                <!-- Tampilan Belum Login (Default) -->
                <button id="btn-login-nav" class="auth-btn" onclick="navigateTo('login')">Login</button>
                
                <!-- Tampilan Sudah Login (Hidden by default) -->
                <div id="user-profile-nav" class="user-profile hidden">
                    <span id="display-name">User</span>
                    <span id="admin-badge-nav" class="badge-admin hidden">ADMIN</span>
                    <span class="logout-btn" onclick="handleLogout()"><i class="fas fa-sign-out-alt"></i> Logout</span>
                </div>
            </div>
        </nav>
    </header>

    <!-- VIEW 1: HOME -->
    <main id="view-home" class="fade-in">
        <section class="hero">
            <h1>Pilih Jenis Perawatan</h1>
            <p>Apakah kulit Anda membutuhkan hidrasi ringan atau nutrisi intensif?</p>
        </section>
        <div class="selection-container">
            <article class="card toner-card" onclick="navigateTo('toner')">
                <div class="card-image"><img src="https://picsum.photos/seed/watertoner/600/400" alt="Toner"></div>
                <div class="card-content">
                    <i class="fas fa-spray-can card-icon"></i><h2>Toner</h2>
                    <p>Penyegar kulit untuk mengembalikan pH balance.</p>
                    <span class="btn-card">Lihat Detail</span>
                </div>
            </article>
            <article class="card serum-card" onclick="navigateTo('serum')">
                <div class="card-image"><img src="https://picsum.photos/seed/goldserum/600/400" alt="Serum"></div>
                <div class="card-content">
                    <i class="fas fa-flask card-icon"></i><h2>Serum</h2>
                    <p>Konsentrat nutrisi tinggi untuk kulit sehat bercahaya.</p>
                    <span class="btn-card">Lihat Detail</span>
                </div>
            </article>
        </div>
    </main>

    <!-- VIEW 2: TONER DETAIL -->
    <section id="view-toner" class="product-page hidden fade-in">
        <div class="detail-container">
            <div class="detail-image"><img src="https://picsum.photos/seed/watertoner/800/800" alt="Detail Toner"></div>
            <div class="detail-content">
                <div class="back-btn" onclick="navigateTo('home')"><i class="fas fa-arrow-left"></i> Kembali ke Menu</div>
                <h2>BAWI TONER</h2>
                <span class="detail-price">Rp 40.000</span>
                <p class="detail-desc">Inspired by natural 'Bawi Kuwu' treatments, this toner blends Taya stem, Dayak onion, Bajakah water, and Pandan leaves. Natural solution for acne-prone skin.</p>
                <div class="feature-grid">
                    <div class="feature-item"><i class="fas fa-check-circle"></i> Acne Prone Skin</div>
                    <div class="feature-item"><i class="fas fa-check-circle"></i> Sensitive Skin</div>
                    <div class="feature-item"><i class="fas fa-check-circle"></i> Calming Redness</div>
                    <div class="feature-item"><i class="fas fa-check-circle"></i> 20ml</div>
                </div>
                <button class="action-btn" onclick="navigateTo('toner-forum')">Lihat Diskusi Toner</button>
            </div>
        </div>
    </section>

    <!-- VIEW 3: SERUM DETAIL -->
    <section id="view-serum" class="product-page hidden fade-in">
        <div class="detail-container">
            <div class="detail-image"><img src="https://picsum.photos/seed/goldserum/800/800" alt="Detail Serum"></div>
            <div class="detail-content">
                <div class="back-btn" onclick="navigateTo('home')"><i class="fas fa-arrow-left"></i> Kembali ke Menu</div>
                <h2>TABELA Serum</h2>
                <span class="detail-price">Rp 10.000</span>
                <p class="detail-desc">Serum wajah dengan kandungan Vitamin C dan Niacinamide untuk mencerahkan kulit dan menyamarkan noda hitam. Teksturnya ringan dan cepat menyerap.</p>
                <div class="feature-grid">
                    <div class="feature-item"><i class="fas fa-check-circle"></i> Brightening</div>
                    <div class="feature-item"><i class="fas fa-check-circle"></i> Anti Aging</div>
                    <div class="feature-item"><i class="fas fa-check-circle"></i> Vitamin C 20%</div>
                    <div class="feature-item"><i class="fas fa-check-circle"></i> 10ml</div>
                </div>
                <button class="action-btn" onclick="navigateTo('serum-forum')">Lihat Diskusi Serum</button>
            </div>
        </div>
    </section>

    <!-- VIEW 4: FORUM TONER -->
    <section id="view-toner-forum" class="product-page hidden fade-in">
        <div style="padding-bottom: 2rem;">
            <div class="back-btn" onclick="navigateTo('toner')"><i class="fas fa-arrow-left"></i> Kembali ke Produk Toner</div>
            
            <div class="qa-feed-header" style="border-bottom-color: var(--accent-toner);">
                <h2 style="color: var(--accent-toner-dark);">Diskusi Bawi Toner</h2>
                <p style="color: var(--text-light);">Khusus tanya jawab seputar Bawi Toner.</p>
            </div>

            <div class="forum-wrapper">
                <div class="form-card">
                    <h3 style="margin-bottom: 1.5rem;">Ajukan Pertanyaan (Toner)</h3>
                    <form id="qaForm-toner" onsubmit="postQuestion(event, 'Bawi Toner')">
                        <div class="form-group">
                            <label class="form-label">Nama</label>
                            <input type="text" id="askerName-toner" class="form-input" placeholder="Tulis nama Anda..." required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Produk</label>
                            <select id="askProduct-toner" class="form-select" disabled><option value="Bawi Toner" selected>Bawi Toner</option></select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Pertanyaan</label>
                            <textarea id="askContent-toner" class="form-textarea" rows="4" placeholder="Tanya seputar Toner..." required></textarea>
                        </div>
                        <button type="submit" class="submit-btn">Kirim ke Forum Toner <i class="fas fa-paper-plane"></i></button>
                    </form>
                </div>
                <div class="qa-feed" id="qaFeed-toner"></div>
            </div>
        </div>
    </section>

    <!-- VIEW 5: FORUM SERUM -->
    <section id="view-serum-forum" class="product-page hidden fade-in">
        <div style="padding-bottom: 2rem;">
            <div class="back-btn" onclick="navigateTo('serum')"><i class="fas fa-arrow-left"></i> Kembali ke Produk Serum</div>
            
            <div class="qa-feed-header" style="border-bottom-color: var(--accent-serum);">
                <h2 style="color: var(--accent-serum-dark);">Diskusi Tabela Serum</h2>
                <p style="color: var(--text-light);">Khusus tanya jawab seputar Tabela Serum.</p>
            </div>

            <div class="forum-wrapper">
                <div class="form-card">
                    <h3 style="margin-bottom: 1.5rem;">Ajukan Pertanyaan (Serum)</h3>
                    <form id="qaForm-serum" onsubmit="postQuestion(event, 'Tabela Serum')">
                        <div class="form-group">
                            <label class="form-label">Nama</label>
                            <input type="text" id="askerName-serum" class="form-input" placeholder="Tulis nama Anda..." required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Produk</label>
                            <select id="askProduct-serum" class="form-select" disabled><option value="Tabela Serum" selected>Tabela Serum</option></select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Pertanyaan</label>
                            <textarea id="askContent-serum" class="form-textarea" rows="4" placeholder="Tanya seputar Serum..." required></textarea>
                        </div>
                        <button type="submit" class="submit-btn">Kirim ke Forum Serum <i class="fas fa-paper-plane"></i></button>
                    </form>
                </div>
                <div class="qa-feed" id="qaFeed-serum"></div>
            </div>
        </div>
    </section>

    <!-- VIEW 6: LOGIN -->
    <section id="view-login" class="hidden fade-in">
        <div class="auth-container">
            <h2>Login Akun</h2>
            <p style="font-size:0.8rem; color:#888; margin-bottom:1rem;">
                Gunakan email <strong>admin@glowskin.com</strong> untuk login sebagai Admin.
            </p>
            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" id="login-email" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" id="login-pass" class="form-input" required>
                </div>
                <button type="submit" class="primary-btn">Masuk</button>
            </form>
            <div class="auth-switch">
                Belum punya akun? <a onclick="navigateTo('register')">Daftar disini</a>
            </div>
        </div>
    </section>

    <!-- VIEW 7: REGISTER -->
    <section id="view-register" class="hidden fade-in">
        <div class="auth-container">
            <h2>Daftar Akun Baru</h2>
            <form onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label class="form-label">Nama Panggilan</label>
                    <input type="text" id="reg-name" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" id="reg-email" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" id="reg-pass" class="form-input" required>
                </div>
                <button type="submit" class="primary-btn">Daftar</button>
            </form>
            <div class="auth-switch">
                Sudah punya akun? <a onclick="navigateTo('login')">Login disini</a>
            </div>
        </div>
    </section>

    <footer><p>&copy; Sejak 2025 GlowSkin Indonesia</p></footer>

    <script>
        // ==========================================
        // 1. KONFIGURASI FIREBASE & ADMIN
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyChfGHmmnynHcIrspY17--RVKMyj609HUg",
            authDomain: "web-kir.firebaseapp.com",
            databaseURL: "https://web-kir-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "web-kir",
            storageBucket: "web-kir.firebasestorage.app",
            messagingSenderId: "924508236082",
            appId: "1:924508236082:web:73ea433f8e0c6204934f2b",
            measurementId: "G-Y5RVQQ2FQ9"
        };

        // EMAIL KHUSUS UNTUK ADMIN
        const ADMIN_EMAIL = "admin@glowskin.com"; 

        // Inisialisasi Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth(); 

        let questions = [];
        let currentUser = null; 

        // ==========================================
        // 2. AUTH STATE (Cek Status Login & Admin)
        // ==========================================
        auth.onAuthStateChanged((user) => {
            currentUser = user;
            updateAuthUI(user);
        });

        function isAdmin() {
            return currentUser && currentUser.email === ADMIN_EMAIL;
        }

        function updateAuthUI(user) {
            const loginBtn = document.getElementById('btn-login-nav');
            const profileDiv = document.getElementById('user-profile-nav');
            const displayName = document.getElementById('display-name');
            const adminBadgeNav = document.getElementById('admin-badge-nav');
            
            const nameInputToner = document.getElementById('askerName-toner');
            const nameInputSerum = document.getElementById('askerName-serum');

            if (user) {
                // SUDAH LOGIN
                loginBtn.classList.add('hidden');
                profileDiv.classList.remove('hidden');
                
                const nameToShow = user.displayName || user.email.split('@')[0];
                displayName.innerText = nameToShow;

                // Tampilkan badge admin jika login sebagai admin
                if(isAdmin()) {
                    adminBadgeNav.classList.remove('hidden');
                    // Auto isi nama jadi Admin jika belum diisi
                    if(nameInputToner && nameInputToner.value === "") nameInputToner.value = "Admin GlowSkin";
                    if(nameInputSerum && nameInputSerum.value === "") nameInputSerum.value = "Admin GlowSkin";
                } else {
                    adminBadgeNav.classList.add('hidden');
                    // Auto isi nama user biasa
                    if(nameInputToner && nameInputToner.value === "") nameInputToner.value = nameToShow;
                    if(nameInputSerum && nameInputSerum.value === "") nameInputSerum.value = nameToShow;
                }

            } else {
                // BELUM LOGIN
                loginBtn.classList.remove('hidden');
                profileDiv.classList.add('hidden');
                adminBadgeNav.classList.add('hidden');
                if(nameInputToner) nameInputToner.value = "";
                if(nameInputSerum) nameInputSerum.value = "";
            }
        }

        // ==========================================
        // 3. FUNGSI LOGIN & REGISTER
        // ==========================================
        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-pass').value;

            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    alert("Login Berhasil! Selamat datang " + (isAdmin() ? "Admin" : "User"));
                    navigateTo('home');
                })
                .catch((error) => {
                    alert("Login Gagal: " + error.message);
                });
        }

        function handleRegister(e) {
            e.preventDefault();
            const name = document.getElementById('reg-name').value;
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-pass').value;

            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    userCredential.user.updateProfile({ displayName: name })
                        .then(() => {
                            alert("Registrasi Berhasil! Selamat Datang, " + name);
                            navigateTo('home');
                        });
                })
                .catch((error) => {
                    alert("Registrasi Gagal: " + error.message);
                });
        }

        function handleLogout() {
            if(confirm("Yakin ingin logout?")) {
                auth.signOut()
                    .then(() => {
                        navigateTo('home');
                    });
            }
        }

        // ==========================================
        // 4. LISTEN KE DATABASE
        // ==========================================
        function listenToDatabase() {
            const questionsRef = database.ref('questions');
            
            questionsRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    questions = Object.keys(data).map(key => data[key]);
                    questions.sort((a, b) => b.timestamp - a.timestamp);
                    
                    const activeView = document.querySelector('section:not(.hidden)').id;
                    if (activeView === 'view-toner-forum') renderFeed('Bawi Toner');
                    if (activeView === 'view-serum-forum') renderFeed('Tabela Serum');
                } else {
                    questions = [];
                }
            });
        }

        // ==========================================
        // 5. NAVIGASI
        // ==========================================
        function navigateTo(viewName) {
            const views = ['view-home', 'view-toner', 'view-serum', 'view-toner-forum', 'view-serum-forum', 'view-login', 'view-register'];
            views.forEach(id => document.getElementById(id).classList.add('hidden'));

            if (viewName === 'toner') document.getElementById('view-toner').classList.remove('hidden');
            else if (viewName === 'serum') document.getElementById('view-serum').classList.remove('hidden');
            else if (viewName === 'toner-forum') {
                document.getElementById('view-toner-forum').classList.remove('hidden');
                renderFeed('Bawi Toner');
            } else if (viewName === 'serum-forum') {
                document.getElementById('view-serum-forum').classList.remove('hidden');
                renderFeed('Tabela Serum');
            } else if (viewName === 'login') {
                if(currentUser) { alert("Anda sudah login!"); return; }
                document.getElementById('view-login').classList.remove('hidden');
            } else if (viewName === 'register') {
                if(currentUser) { alert("Anda sudah login!"); return; }
                document.getElementById('view-register').classList.remove('hidden');
            } else {
                document.getElementById('view-home').classList.remove('hidden');
            }
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ==========================================
        // 6. RENDER FORUM (LOGIC USER & ADMIN)
        // ==========================================
        function renderFeed(productFilter) {
            let containerId = productFilter === 'Bawi Toner' ? 'qaFeed-toner' : 'qaFeed-serum';
            const feedContainer = document.getElementById(containerId);
            feedContainer.innerHTML = ''; 

            const filteredQuestions = questions.filter(q => q.product === productFilter);

            if(filteredQuestions.length === 0) {
                feedContainer.innerHTML = '<p style="text-align:center; color:#999; padding:2rem;">Belum ada diskusi untuk produk ini.</p>';
                return;
            }

            // Cek apakah user login adalah admin
            const currentUserIsAdmin = isAdmin();

            filteredQuestions.forEach((q) => {
                // Cek kepemilikan pertanyaan
                const isMyQuestion = (currentUser && q.userEmail === currentUser.email);
                
                // Cek apakah penanya adalah admin
                const isAuthorAdmin = (q.userEmail === ADMIN_EMAIL);
                
                // Admin punya akses hapus miliknya ATAU admin bisa hapus semuanya
                const canDelete = isMyQuestion || currentUserIsAdmin;

                const questionClass = isMyQuestion ? 'qa-card my-question' : 'qa-card';
                
                // Tampilkan Badge Admin jika penanya adalah admin
                const adminBadge = isAuthorAdmin ? '<span class="badge-admin">ADMIN</span>' : '';
                
                let repliesHTML = '';
                if (q.replies) {
                    const replyList = Object.keys(q.replies).map(key => q.replies[key]);
                    replyList.forEach(r => {
                        const isMyReply = (currentUser && r.userEmail === currentUser.email);
                        const isReplyAuthorAdmin = (r.userEmail === ADMIN_EMAIL);
                        const replyClass = isMyReply ? 'reply-item my-reply' : 'reply-item';
                        
                        // Badge Admin untuk Reply
                        const replyAdminBadge = isReplyAuthorAdmin ? '<span class="badge-admin">ADMIN</span>' : '';

                        repliesHTML += `
                            <div class="${replyClass}">
                                <div class="reply-header">
                                    <span class="reply-name">${r.name} ${replyAdminBadge}</span>
                                    <span>${r.date}</span>
                                </div>
                                <div>${r.text}</div>
                            </div>
                        `;
                    });
                }

                const deleteBtnHtml = canDelete ? 
                    `<button class="delete-btn" onclick="deleteQuestion(${q.id})"><i class="fas fa-trash-alt"></i></button>` : '';

                const html = `
                    <div class="${questionClass}">
                        ${isMyQuestion ? '<div style="position:absolute; top:-10px; left:20px; background:var(--accent-me); color:white; padding:2px 10px; font-size:0.7rem; border-radius:10px;">Pertanyaan Anda</div>' : ''}
                        
                        ${deleteBtnHtml}

                        <div class="qa-meta">
                            <div class="qa-avatar"><i class="fas fa-user"></i></div>
                            <div>
                                <span class="qa-name">${q.name} ${adminBadge}</span> â€¢ <span style="font-size: 0.8rem; color: #999;">${q.date}</span>
                                <div style="font-size: 0.75rem; background: ${getProductColor(q.product)}; color: white; padding: 2px 8px; border-radius: 4px; display: inline-block; margin-left: 5px;">${q.product}</div>
                            </div>
                        </div>
                        <div class="qa-question" style="${isMyQuestion ? 'color:var(--accent-me);' : ''}">${q.question}</div>

                        <div class="qa-replies-list">
                            ${repliesHTML}
                        </div>

                        <div class="reply-form-input-area" id="replyForm-${q.id}">
                            <input type="text" id="replyText-${q.id}" class="form-input" placeholder="Tulis balasanmu..." style="margin-bottom: 5px;">
                            <button onclick="submitReply(${q.id})" class="btn-card" style="font-size: 0.8rem; padding: 5px 15px; background-color: var(--accent-toner);">Kirim Balasan</button>
                        </div>
                        <button onclick="toggleReply(${q.id})" class="btn-reply"><i class="fas fa-reply"></i> Balas</button>
                    </div>
                `;
                feedContainer.innerHTML += html;
            });
        }

        function getProductColor(product) {
            if (product.includes('Toner')) return '#9e8fb2';
            if (product.includes('Serum')) return '#e6a4a4';
            return '#999';
        }

        // ==========================================
        // 7. AKSI POST
        // ==========================================
        function postQuestion(e, productName) {
            e.preventDefault();
            
            const nameId = productName === 'Bawi Toner' ? 'askerName-toner' : 'askerName-serum';
            const contentId = productName === 'Bawi Toner' ? 'askContent-toner' : 'askContent-serum';
            
            const nameVal = document.getElementById(nameId).value;
            const content = document.getElementById(contentId).value;

            if (!nameVal.trim()) { alert("Nama harus diisi!"); return; }

            const userEmail = currentUser ? currentUser.email : "guest@example.com";

            const newQuestion = {
                id: Date.now(),
                timestamp: Date.now(),
                name: nameVal, 
                userEmail: userEmail, 
                product: productName,
                question: content,
                replies: [],
                date: "Baru saja"
            };

            database.ref('questions').push(newQuestion);
            document.getElementById(contentId).value = '';
            alert("Pertanyaan berhasil dikirim!");
        }

        function submitReply(qId) {
            if (!currentUser) { alert("Anda harus Login dulu untuk membalas!"); navigateTo('login'); return; }

            const input = document.getElementById(`replyText-${qId}`);
            const replyText = input.value;

            if (replyText.trim() !== "") {
                database.ref('questions').orderByChild('id').equalTo(qId).once('value', snapshot => {
                    if (snapshot.exists()) {
                        const key = Object.keys(snapshot.val())[0];
                        const newReply = {
                            name: currentUser.displayName || "User", // Pakai nama login untuk reply
                            userEmail: currentUser.email,
                            text: replyText,
                            date: "Baru saja"
                        };
                        database.ref('questions/' + key + '/replies').push(newReply);
                        
                        input.value = '';
                        const form = document.getElementById(`replyForm-${q.id}`);
                        form.style.display = 'none';
                    }
                });
            }
        }

        function deleteQuestion(qId) {
            if (!currentUser) return;

            // Jika Admin, langsung hapus
            if (isAdmin()) {
                if (confirm("Anda adalah Admin. Hapus pertanyaan ini?")) {
                    performDelete(qId);
                }
                return;
            }

            // Jika User Biasa, cek kepemilikan
            const qIndex = questions.findIndex(q => q.id === qId);
            if(qIndex > -1 && questions[qIndex].userEmail !== currentUser.email) {
                alert("Anda tidak bisa menghapus pertanyaan orang lain!");
                return;
            }

            if (confirm("Hapus pertanyaan ini?")) {
                performDelete(qId);
            }
        }

        function performDelete(qId) {
            database.ref('questions').orderByChild('id').equalTo(qId).once('value', snapshot => {
                snapshot.forEach(child => {
                    child.ref.remove();
                });
            });
        }

        function toggleReply(qId) {
            if (!currentUser) { alert("Anda harus Login dulu!"); navigateTo('login'); return; }
            
            const form = document.getElementById(`replyForm-${qId}`);
            if (form.style.display === 'block') {
                form.style.display = 'none';
            } else {
                form.style.display = 'block';
                document.getElementById(`replyText-${qId}`).focus();
            }
        }

        listenToDatabase();

    </script>
</body>
</html>
